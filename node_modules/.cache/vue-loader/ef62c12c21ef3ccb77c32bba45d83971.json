{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportData/pay/pay.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportData/pay/pay.vue","mtime":1582794096795},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {queryAllPayReq} from '@/api/index';\n\nexport default {\n    name: 'pay',\n    comments: {},\n    data() {\n        return {\n            columnspro:[],\n            columns: [\n                // {\n                // \ttype: 'expand',\n                // \twidth: 50,\n                // \tfixed: 'left',\n                // \trender: (h, params) => {\n                // \t\treturn h(expandRow, {\n                // \t\t\tprops: {\n                // \t\t\t\trow: params.row\n                // \t\t\t}\n                // \t\t});\n                // \t}\n                // },\n                {\n                    type: 'index',\n                    width: 60,\n                    align: 'center',\n                    fixed: 'left'\n                },\n                {\n                    title: '日期(星期)',\n                    key: 'ds',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '操作系统',\n                    key: 'os',\n                    width: 150,\n                    checkAccess: [2]\n                    // sortable: true,\n                    // fixed: 'left'\n                },\n                {\n                    title: '小时',\n                    key:'dayOfHour',\n                    width: 150,\n                    checkAccess: [3]\n                  //   render:(h,params)=>{\n                  //       return h('div', { style: {\n                  //               display:(params.row.dayOfHour==0)?\"none\":\"inline-block\",\n                  //               color: '#FF7D41'\n                  //       }\n                  //       },params.row.dayOfHour);\n                  // },\n                    // sortable: true\n                },\n                {\n                    title: '渠道',\n                    key: 'creative',\n                    width: 150,\n                    checkAccess: [4]\n                    // sortable: true\n                },\n                {\n                    title: '服',\n                    key: 'client',\n                    width: 150,\n                    checkAccess: [1]\n                    // sortable: true\n                },\n                {\n                    title: '活跃数',\n                    key: 'dauNum',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '注册数',\n                    key: 'installNum',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '付费人数',\n                    key: 'payCount',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '付费金额',\n                    key: 'payAmount',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '付费率',\n                    key: 'payRate',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '付费次数',\n                    key: 'payTimes',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '安装付费人数',\n                    key: 'payInstallCount',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '安装付费金额',\n                    key: 'payInstallAmount',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '安装付费次数',\n                    key: 'payInstallTimes',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: 'snid',\n                    key: 'snid',\n                    width: 150\n                    // sortable: true\n                },\n                // {\n                // \ttitle: '创建时间',\n                // \tkey: 'createTime',\n                // \tsortable: true,\n                // \tsortType: 'desc',\n                // \twidth: 150\n                // },\n            ],\n            columnscc: [\n                {\n                    type: 'index',\n                    width: 60,\n                    align: 'center',\n                    fixed: 'left'\n                },\n                {\n                    title: '日期(星期)',\n                    key: 'ds',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '操作系统',\n                    key: 'os',\n                    width: 150,\n                    checkAccess: [2]\n                    // sortable: true,\n                    // fixed: 'left'\n                },\n                {\n                    title: '活跃数',\n                    key: 'dauNum',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '注册数',\n                    key: 'installNum',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '付费人数',\n                    key: 'payCount',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '付费金额',\n                    key: 'payAmount',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '付费次数',\n                    key: 'payTimes',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '安装付费人数',\n                    key: 'payInstallCount',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '安装付费金额',\n                    key: 'payInstallAmount',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '付费率',\n                    key: 'payRate',\n                    width: 150\n                    // sortable: true\n                },\n                {\n                    title: '安装付费次数',\n                    key: 'payInstallTimes',\n                    width: 150\n                    // sortable: true\n                },\n            ],\n            data: [],\n            searchForm: {\n                source: '0',\n                creativeid:'',\n                clientid:'',\n                gameid: parseInt(this.getStore('gameid')),\n                day: '7',\n                os: '0',\n                page:1\n            },\n            total: 0,\n            games: [],\n            sharePayResultTypesCC: [],\n            creatives:[],\n            clients:[],\n            clientmap:[],\n            creativemap:[],\n            surveyManyLine: {},\n            handelPayCount: [],\n            key:'all',\n            showcreative:false,\n            showclient:false,\n            showcc:true,\n        };\n    },\n    methods: {\n        init() {\n            this.queryAllServer();\n        },\n        handleSearch() {\n            this.queryAllServer();\n        },\n        queryAllServer() {\n            this.columnspro = JSON.parse(JSON.stringify(this.columns));\n            if(this.searchForm.day!=0&&this.searchForm.day!=1){\n                this.handleColumns(3)\n            }\n            if(this.searchForm.os == 0&&this.searchForm.clientid ==''&&this.searchForm.creative ==null){\n                this.handleColumns(2)\n            }\n            if(this.searchForm.clientid ==''){\n                this.handleColumns(1)\n            }\n            if(this.searchForm.creative == null){\n                this.handleColumns(4)\n            }\n            queryAllPayReq(this.searchForm).then(res => {\n                // this.loading = false;\n                if (res.success) {\n                    this.data = res.msg;\n                    this.sharePayResultTypesCC = res.sharePayResultTypesCC;\n                    this.creatives = res.creatives;\n                    this.clients = res.clients;\n                    this.surveyManyLine.changeData(this.handelPayCount);\n                    //\n                    this.creativemap = (res.creatives).map(item => ({\n                        key: item.creativeid,\n                        name: item.creativeName,\n                    }));\n                    let allObject = new Object();\n                    allObject.key = '0';\n                    allObject.name = '全渠道';\n                    this.creativemap.unshift(allObject);\n                    let creativeMap = new Map();\n                    this.creativemap.forEach((item, index) => {\n                        creativeMap.set(item.key, item.name)\n                    })\n                    //\n                    this.clientmap = (res.clients).map(item =>({\n                        key:item.serverid,\n                        name:item.serverName,\n                    }));\n                    let allObject2 = new Object();\n                    allObject2.key = '-1'\n                    allObject2.name = '所有服'\n                    this.clientmap.unshift(allObject2);\n                    let clientMap = new Map();\n                    this.clientmap.forEach((item, indx) => {\n                        clientMap.set(item.key, item.name)\n                    })\n\n                    this.tableDataProcess(this.data,creativeMap,clientMap);\n                    this.tableDataProcess(this.sharePayResultTypesCC,creativeMap,clientMap);\n\n                    this.handelPayCount = this.makeCavas(this.data, this.searchForm.day);\n                    this.surveyManyLine.changeData(this.handelPayCount);\n                }\n            });\n\n        },\n        showclients(val) {\n            if (val=='all'){\n                this.showcreative=false;\n                this.showclient=false;\n                this.showcc=true;\n                delete this.searchForm.creative;\n                this.searchForm.clientid='';\n            }else if(val=='creative'){\n                this.showcreative=true;\n                this.showclient=false;\n                this.showcc=false;\n                this.searchForm.creative = '0';\n                this.searchForm.clientid='';\n            }else {\n                this.showcreative=false;\n                this.showclient=true;\n                this.showcc=false;\n                delete this.searchForm.creative;\n                this.searchForm.clientid = '-1';\n            }\n        },\n        handleColumns(access) {\n            this.columnspro.map((item, index) => {\n                let checkAccess = item.checkAccess\n                if(checkAccess){\n                    if (checkAccess - Number(access) == 0) {\n                        this.columnspro.splice(index, 1)\n                    } else {\n                        console.log(index)\n                    }\n                }\n            })\n        },\n        weekFunction: function (ds) {\n            let week = new Date(ds);\n            let dateweek = week.getDay();\n            let i = 7 - dateweek;\n            switch (i) {\n                case 7:\n                    ds = ds + \"(七)\";\n                    break\n                case 1:\n                    ds = ds + \"(六)\";\n                    break\n                case 2:\n                    ds = ds + \"(五)\";\n                    break\n                case 3:\n                    ds = ds + \"(四)\";\n                    break\n                case 4:\n                    ds = ds + \"(三)\";\n                    break\n                case 5:\n                    ds = ds + \"(二)\";\n                    break\n                case 6:\n                    ds = ds + \"(一)\";\n                    break\n                default:\n            }\n            return ds;\n        },\n        surveyManyLineChart() {\n            /*---------------------多折线图-------------------*/\n            this.surveyManyLine = new G2.Chart({\n                container: 'surveyManyLine',\n                forceFit: true,\n                height: 500\n            });\n            this.surveyManyLine.source(this.handelPayCount, {});\n            this.surveyManyLine.scale('value', {\n                min: 0,\n                alias: '人数',\n            });\n            this.surveyManyLine.scale('time', {\n                tickCount: 6,\n            });\n            this.surveyManyLine.tooltip({\n                crosshairs: {\n                    type: 'line'\n                }\n            });\n            // 坐标轴文本旋转\n            this.surveyManyLine.axis('time', {\n                label: {\n                    rotate: -Math.PI / 2.5,\n                    textAlign: 'end',\n                    textBaseline: 'middle'\n                }\n            });\n            this.surveyManyLine.axis('time', {\n                label: {\n                    formatter: val => {\n                        return val;\n                    }\n                }\n            });\n            //设置图列居中显示\n            this.surveyManyLine.legend({\n                position: 'bottom', //图列位置\n                align: 'center', //图例的对齐方式\n                itemWidth: null\n            });\n            this.surveyManyLine\n                .line()\n                .position('time*value')\n                .color('type')\n                .shape('smooth');\n            this.surveyManyLine\n                .point()\n                .position('time*value')\n                .color('type')\n                .size(4)\n                .shape('circle')\n                .style({\n                    stroke: '#fff',\n                    lineWidth: 1\n                });\n            this.surveyManyLine.render();\n        },\n        makeCavas: (data, date) => {\n            if (data) {\n                if (date == 0) {\n                    data.sort(function (a, b) {\n                        return b.dayOfHour - a.dayOfHour;\n                    });\n                }\n                let handelPayCount = [];\n                data.forEach((item, index) => {\n                    let infopayCount = new Object();\n                    if (date != 7 && date != 30) {\n                        infopayCount.time = item.dayOfHour + '时';\n                    } else {\n                        infopayCount.time = (item.ds).substr(5, 5);\n                    }\n                    infopayCount.value = item.payCount;\n                    infopayCount.type = '付费人数';\n                    handelPayCount.push(infopayCount);\n                    let infopayAmount = new Object();\n                    if (date != 7 && date != 30) {\n                        infopayAmount.time = item.dayOfHour + '时';\n                    } else {\n                        infopayAmount.time = (item.ds).substr(5, 5);\n                    }\n                    infopayAmount.value = item.payAmount;\n                    infopayAmount.type = '付费金额';\n                    handelPayCount.push(infopayAmount);\n                    let infopayTimes = new Object();\n                    if (date != 7 && date != 30) {\n                        infopayTimes.time = item.dayOfHour + '时';\n                    } else {\n                        infopayTimes.time = (item.ds).substr(5, 5);\n                    }\n                    infopayTimes.value = item.payTimes;\n                    infopayTimes.type = '付费次数';\n                    handelPayCount.push(infopayTimes);\n                    let infopayInstallCount = new Object();\n                    if (date != 7 && date != 30) {\n                        infopayInstallCount.time = item.dayOfHour + '时';\n                    } else {\n                        infopayInstallCount.time = (item.ds).substr(5, 5);\n                    }\n                    infopayInstallCount.value = item.payInstallCount;\n                    infopayInstallCount.type = '安装付费人数';\n                    handelPayCount.push(infopayInstallCount);\n                    let infopayInstallAmount = new Object();\n                    if (date != 7 && date != 30) {\n                        infopayInstallAmount.time = item.dayOfHour + '时';\n                    } else {\n                        infopayInstallAmount.time = (item.ds).substr(5, 5);\n                    }\n                    infopayInstallAmount.value = item.payInstallAmount;\n                    infopayInstallAmount.type = '安装付费金额';\n                    handelPayCount.push(infopayInstallAmount);\n                    let infoPayInstallTimes = new Object();\n                    if (date != 7 && date != 30) {\n                        infoPayInstallTimes.time = item.dayOfHour + '时';\n                    } else {\n                        infoPayInstallTimes.time = (item.ds).substr(5, 5);\n                    }\n                    infoPayInstallTimes.value = item.payInstallTimes;\n                    infoPayInstallTimes.type = '安装付费次数';\n                    handelPayCount.push(infoPayInstallTimes);\n                });\n                if (date == 7 || date == 30 || date == 0) {\n                    handelPayCount.reverse();\n                }\n                return handelPayCount;\n            }\n        },\n        tableDataProcess(data, creativeMap, clientMap){\n            if (data) {\n                data.forEach((item) => {\n                    item.ds = this.weekFunction(item.ds);\n                    item.client = clientMap.get(String(item.clientid)) === undefined ? item.client : clientMap.get(String(item.clientid));\n                    item.creative = creativeMap.get(item.creative) === undefined ? item.creative : creativeMap.get(item.creative);\n                    item.payRate = item.dauNum == 0 ? 0 : (item.payCount * 100 / item.dauNum).toFixed(2) + \"%\";\n                    item.ARPPU = item.payCount == 0 ? 0 : (item.payAmount / item.payCount).toFixed(2);\n                    item.payInstallRate = item.installNum == 0 ? 0 : (item.payInstallCount * 100 / item.installNum).toFixed(2) + \"%\";\n                    item.payInstallARPU = item.installNum == 0 ? 0 : (item.payInstallAmount / item.installNum).toFixed(2);\n                    item.payInstallARPPU = item.payInstallCount == 0 ? 0 : (item.payInstallAmount / item.payInstallCount).toFixed(2);\n                    item.payAmount = item.payAmount / this.getStore(\"currencyRate\");\n                    item.payInstallAmount = item.payInstallAmount / this.getStore(\"currencyRate\");\n                })\n            }\n            return data;\n        },\n    },\n    mounted() {\n        this.init();\n        this.surveyManyLineChart();\n    }\n};\n",null]}