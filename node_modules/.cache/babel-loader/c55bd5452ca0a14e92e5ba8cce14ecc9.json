{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportdata/reportOnline/reportOnline.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportdata/reportOnline/reportOnline.vue","mtime":1590218196038},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { queryOnline as _queryOnline, queryDaily } from '@/api/index';\nimport { weekChange } from '@/libs/changeWeek';\nexport default {\n  name: \"reportOnline\",\n  data: function data() {\n    return {\n      loadingOnline: true,\n      defaultData: {\n        yestoday: 1,\n        week: 7,\n        month: 30\n      },\n      data: \"7\",\n      columns: [{\n        title: '日期（星期）',\n        key: 'ds',\n        width: 150,\n        fixed: 'left',\n        align: 'center'\n      }, {\n        title: '0-1分钟',\n        width: 150,\n        align: 'center',\n        children: [{\n          title: '人数',\n          key: '01durationNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '留存用户数',\n          key: '01durationRetentionNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '新增率（%）',\n          key: '01installPeople',\n          align: 'center',\n          width: 130\n        }, {\n          title: '留存率（%）',\n          key: '01installRention',\n          align: 'center',\n          width: 130\n        }]\n      }, {\n        title: '1-5分钟',\n        width: 150,\n        align: 'center',\n        children: [{\n          title: '人数',\n          key: '15durationNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '留存用户数',\n          key: '15durationRetentionNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '新增率（%）',\n          key: '15installPeople',\n          align: 'center',\n          width: 130\n        }, {\n          title: '留存率（%）',\n          key: '15installRention',\n          align: 'center',\n          width: 130\n        }]\n      }, {\n        title: '5-10分钟',\n        width: 150,\n        align: 'center',\n        children: [{\n          title: '人数',\n          key: '510durationNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '留存用户数',\n          key: '510durationRetentionNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '新增率（%）',\n          key: '510installPeople',\n          align: 'center',\n          width: 130\n        }, {\n          title: '留存率（%）',\n          key: '510installRention',\n          align: 'center',\n          width: 130\n        }]\n      }, {\n        title: '10-20分钟',\n        width: 150,\n        align: 'center',\n        children: [{\n          title: '人数',\n          key: '1020durationNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '留存用户数',\n          key: '1020durationRetentionNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '新增率（%）',\n          key: '1020installPeople',\n          align: 'center',\n          width: 130\n        }, {\n          title: '留存率（%）',\n          key: '1020installRention',\n          align: 'center',\n          width: 130\n        }]\n      }, {\n        title: '20-30分钟',\n        width: 150,\n        align: 'center',\n        children: [{\n          title: '人数',\n          key: '2030durationNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '留存用户数',\n          key: '2030durationRetentionNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '新增率（%）',\n          key: '2030installPeople',\n          align: 'center',\n          width: 130\n        }, {\n          title: '留存率（%）',\n          key: '2030installRention',\n          align: 'center',\n          width: 130\n        }]\n      }, {\n        title: '大于30分钟',\n        width: 150,\n        align: 'center',\n        children: [{\n          title: '人数',\n          key: '30durationNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '留存用户数',\n          key: '30durationRetentionNumbers',\n          align: 'center',\n          width: 100\n        }, {\n          title: '新增率（%）',\n          key: '30installPeople',\n          align: 'center',\n          width: 130\n        }, {\n          title: '留存率（%）',\n          key: '30installRention',\n          align: 'center',\n          width: 130\n        }]\n      }],\n      tableV: [],\n      charts: [],\n      pyaGroupChart: {},\n      shareDailyResultTypes: [],\n      timeSection: [],\n      startTime: 0,\n      overTime: 0,\n      options: {\n        disabledDate: function disabledDate(date) {\n          return date && date.valueOf() >= Date.now() - 86400000;\n        }\n      }\n    };\n  },\n  methods: {\n    dayEvent: function dayEvent() {\n      this.timeSection = [];\n      this.startTime = 0;\n      this.overTime = 0;\n      this.init();\n    },\n    timeSectionEvent: function timeSectionEvent() {\n      var nowTime = new Date();\n      this.overTime = 0;\n      this.startTime = 0;\n\n      if (nowTime - this.timeSection[0] > 0) {\n        this.startTime = parseInt((nowTime - this.timeSection[0]) / (24 * 60 * 60 * 1000));\n      }\n\n      if (nowTime - this.timeSection[1] > 0) {\n        this.overTime = parseInt((nowTime - this.timeSection[1]) / (24 * 60 * 60 * 1000));\n      }\n\n      this.init();\n    },\n    init: function init() {\n      this.loadingOnline = true;\n      this.queryOnline();\n    },\n    queryOnline: function queryOnline() {\n      var _this = this;\n\n      var paramss = {\n        gameid: parseInt(this.getStore('gameid')),\n        deviceType: 0,\n        osType: 0,\n        data: parseInt(this.data),\n        hxType: 0\n      };\n\n      if (this.startTime !== 0) {\n        paramss.data = this.startTime;\n        this.data = this.startTime;\n      }\n\n      if (this.overTime !== 0) {\n        paramss.overTime = this.overTime;\n      }\n\n      queryDaily(paramss).then(function (e) {\n        _this.loadingOnline = false;\n\n        if (e.success) {\n          var install = new Map();\n          _this.shareDailyResultTypes = e.shareDailyResultTypes.forEach(function (item) {\n            // item.ds = weekChange(item.ds)\n            install.set(item.ds, item.installNum);\n          });\n          var params = {\n            gameid: parseInt(_this.getStore('gameid')),\n            date: parseInt(_this.data)\n          };\n\n          _queryOnline(params).then(function (e) {\n            if (e.success) {\n              var onlines = e.onlineDurationDistributions;\n              var tables = [];\n\n              var _loop = function _loop(info) {\n                var tablesObject = new Object();\n                onlines[info].forEach(function (item) {\n                  tablesObject.ds = weekChange(item.installDs);\n\n                  if (item.duration == '0-1分钟') {\n                    tablesObject['01durationNumbers'] = item.durationNumbers;\n                    tablesObject['01durationRetentionNumbers'] = item.durationRetentionNumbers;\n                    tablesObject['01installPeople'] = install.get(item.installDs) == '' ? '' : (item.durationNumbers / install.get(item.installDs) * 100).toFixed(2);\n                    tablesObject['01installRention'] = install.get(item.installDs) == '' ? '' : (item.durationRetentionNumbers / item.durationNumbers * 100).toFixed(2);\n                  } else if (item.duration == '1-5分钟') {\n                    tablesObject['15durationNumbers'] = item.durationNumbers;\n                    tablesObject['15durationRetentionNumbers'] = item.durationRetentionNumbers;\n                    tablesObject['15installPeople'] = install.get(item.installDs) == '' ? '' : (item.durationNumbers / install.get(item.installDs) * 100).toFixed(2);\n                    tablesObject['15installRention'] = install.get(item.installDs) == '' ? '' : (item.durationRetentionNumbers / item.durationNumbers * 100).toFixed(2);\n                  } else if (item.duration == '5-10分钟') {\n                    tablesObject['510durationNumbers'] = item.durationNumbers;\n                    tablesObject['510durationRetentionNumbers'] = item.durationRetentionNumbers;\n                    tablesObject['510installPeople'] = install.get(item.installDs) == '' ? '' : (item.durationNumbers / install.get(item.installDs) * 100).toFixed(2);\n                    tablesObject['510installRention'] = install.get(item.installDs) == '' ? '' : (item.durationRetentionNumbers / item.durationNumbers * 100).toFixed(2);\n                  } else if (item.duration == '10-20分钟') {\n                    tablesObject['1020durationNumbers'] = item.durationNumbers;\n                    tablesObject['1020durationRetentionNumbers'] = item.durationRetentionNumbers;\n                    tablesObject['1020installPeople'] = install.get(item.installDs) == '' ? '' : (item.durationNumbers / install.get(item.installDs) * 100).toFixed(2);\n                    tablesObject['1020installRention'] = install.get(item.installDs) == '' ? '' : (item.durationRetentionNumbers / item.durationNumbers * 100).toFixed(2);\n                  } else if (item.duration == '20-30分钟') {\n                    tablesObject['2030durationNumbers'] = item.durationNumbers;\n                    tablesObject['2030durationRetentionNumbers'] = item.durationRetentionNumbers;\n                    tablesObject['2030installPeople'] = install.get(item.installDs) == '' ? '' : (item.durationNumbers / install.get(item.installDs) * 100).toFixed(2);\n                    tablesObject['2030installRention'] = install.get(item.installDs) == '' ? '' : (item.durationRetentionNumbers / item.durationNumbers * 100).toFixed(2);\n                  } else if (item.duration == '大于30分钟') {\n                    tablesObject['30durationNumbers'] = item.durationNumbers;\n                    tablesObject['30durationRetentionNumbers'] = item.durationRetentionNumbers;\n                    tablesObject['30installPeople'] = install.get(item.installDs) == '' ? '' : (item.durationNumbers / install.get(item.installDs) * 100).toFixed(2);\n                    tablesObject['30installRention'] = install.get(item.installDs) == '' ? '' : (item.durationRetentionNumbers / item.durationNumbers * 100).toFixed(2);\n                  }\n                });\n                tables.push(tablesObject);\n              };\n\n              for (var info in onlines) {\n                _loop(info);\n              }\n\n              tables.sort(_this.compare); // let firstData = [];\n              // onlines.forEach(item => {\n              //     item.ds = weekChange(item.ds);\n              //     item.installPeople = (item.durationNumbers / install.get(item.ds) * 100).toFixed(2) + '%';\n              //     item.installRention = (item.durationRetentionNumbers / install.get(item.ds) * 100).toFixed(2) + '%';\n              //     //取出最近一天的\n              //     if (item.ds == onlines[0].ds) {\n              //         firstData.push(item);\n              //     }\n              // })\n              // //处理分组柱状图数据\n              // let charts = [];\n              // firstData.forEach(item => {\n              //     let peoplesObj = new Object();\n              //     peoplesObj.name = '人数';\n              //     peoplesObj.duration = item.duration;\n              //     peoplesObj.value = item.durationNumbers;\n              //     let dauNumObj = new Object();\n              //     dauNumObj.name = '留存用户数';\n              //     dauNumObj.duration = item.duration;\n              //     dauNumObj.value = item.durationRetentionNumbers;\n              //     charts.push(peoplesObj);\n              //     charts.push(dauNumObj);\n              // })\n              // this.charts = charts;\n\n              _this.tableV = tables; // this.pyaGroupChart.changeData(this.charts);\n            }\n          });\n        }\n      });\n    },\n    // clickOnlineTable(data) {\n    //     let firstData = [];\n    //     this.tableV.forEach(item => {\n    //         if (item.ds == data.ds) {\n    //             firstData.push(item);\n    //         }\n    //         }\n    //     })\n    //     let charts = [];\n    //     firstData.forEach(item => {\n    //         let peoplesObj = new Object();\n    //         peoplesObj.name = '人数';\n    //         peoplesObj.duration = item.duration;\n    //         peoplesObj.value = item.durationNumbers;\n    //         let dauNumObj = new Object();\n    //         dauNumObj.name = '留存用户数';\n    //         dauNumObj.duration = item.duration;\n    //         dauNumObj.value = item.durationRetentionNumbers;\n    //         charts.push(peoplesObj);\n    //         charts.push(dauNumObj);\n    //     })\n    //     this.charts = charts;\n    //     this.pyaGroupChart.changeData(this.charts);\n    // },\n    // G2Online() {\n    //     // 分组柱状图\n    //     this.pyaGroupChart = new G2.Chart({\n    //         container: 'onlineG2',\n    //         forceFit: true,\n    //         height: 350\n    //     });\n    //     this.pyaGroupChart.source(this.charts);\n    //     this.pyaGroupChart.interval().position('duration*value').color('name')\n    //         .adjust([{\n    //             type: 'dodge',\n    //             marginRatio: 1 / 32\n    //         }]);\n    //     this.pyaGroupChart.render();\n    // },\n    compare: function compare(obj1, obj2) {\n      var val1 = obj1.ds;\n      var val2 = obj2.ds;\n\n      if (val1 < val2) {\n        return 1;\n      } else if (val1 > val2) {\n        return -1;\n      } else {\n        return 0;\n      }\n    }\n  },\n  mounted: function mounted() {\n    // this.G2Online();\n    this.init();\n  }\n};",null]}