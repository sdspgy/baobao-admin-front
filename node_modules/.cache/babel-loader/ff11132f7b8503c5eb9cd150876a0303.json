{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportdata/reportPayBehav/reportPayBehav.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportdata/reportPayBehav/reportPayBehav.vue","mtime":1590205479831},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { queryPaymentBehavior } from '@/api/index';\nimport { weekChange } from '@/libs/changeWeek';\nimport vTitleHead from '../../game/template/TitleHead';\nexport default {\n  name: \"reportPayBehav\",\n  components: {\n    vTitleHead: vTitleHead\n  },\n  data: function data() {\n    return {\n      isLoading: true,\n      payHevChart: '付费行为汇总',\n      payHevChartLine: '人均付费',\n      payHevTableMoney: '付费额（元）',\n      payHevTablePeople: '付费人数',\n      isShowCondition: false,\n      defaultData: {\n        yestoday: 1,\n        week: 7,\n        month: 30\n      },\n      data: \"7\",\n      payBehavs: [],\n      payBehavesChart: [],\n      charts: [],\n      columnsPay: [{\n        title: '日期（星期）',\n        key: 'ds',\n        width: 150,\n        align: 'center',\n        fixed: 'left'\n      }, {\n        title: '[0,10}',\n        key: 'one',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(10,50]',\n        key: 'two',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(50,100]',\n        key: 'three',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(100,200]',\n        key: 'foure',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(200,500]',\n        key: 'five',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(500,1000]',\n        key: 'six',\n        align: 'center',\n        width: 150\n      }, {\n        title: '1000以上',\n        key: 'seven' // width: 150\n\n      }],\n      columnsPayPeople: [{\n        title: '日期（星期）',\n        key: 'ds',\n        width: 150,\n        align: 'center',\n        fixed: 'left'\n      }, {\n        title: '[0,10}',\n        key: 'onePeople',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(10,50]',\n        key: 'twoPeople',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(50,100]',\n        key: 'threePeople',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(100,200]',\n        key: 'fourePeople',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(200,500]',\n        key: 'fivePeople',\n        align: 'center',\n        width: 150\n      }, {\n        title: '(500,1000]',\n        key: 'sixPeople',\n        align: 'center',\n        width: 150\n      }, {\n        title: '1000以上',\n        key: 'sevenPeople' // width: 150\n\n      }],\n      pyaGroupChart: {},\n      surveyOneLine: {},\n      timeSection: [],\n      startTime: 0,\n      overTime: 0,\n      options: {\n        disabledDate: function disabledDate(date) {\n          return date && date.valueOf() >= Date.now() - 86400000;\n        }\n      }\n    };\n  },\n  methods: {\n    dayEvent: function dayEvent() {\n      this.timeSection = [];\n      this.startTime = 0;\n      this.overTime = 0;\n      this.init();\n    },\n    timeSectionEvent: function timeSectionEvent() {\n      var nowTime = new Date();\n      this.overTime = 0;\n      this.startTime = 0;\n\n      if (nowTime - this.timeSection[0] > 0) {\n        this.startTime = parseInt((nowTime - this.timeSection[0]) / (24 * 60 * 60 * 1000));\n      }\n\n      if (nowTime - this.timeSection[1] > 0) {\n        this.overTime = parseInt((nowTime - this.timeSection[1]) / (24 * 60 * 60 * 1000));\n      }\n\n      this.queryPay();\n    },\n    enter: function enter() {\n      this.isShowCondition = true;\n    },\n    leave: function leave() {\n      this.isShowCondition = false;\n    },\n    init: function init() {\n      this.isLoading = true;\n      this.queryPay();\n    },\n    queryPay: function queryPay() {\n      var _this = this;\n\n      var params = {\n        gameid: parseInt(this.getStore('gameid')),\n        date: parseInt(this.data)\n      };\n\n      if (this.startTime !== 0) {\n        params.date = this.startTime;\n        this.data = this.startTime;\n      }\n\n      if (this.overTime !== 0) {\n        params.overTime = this.overTime;\n      }\n\n      queryPaymentBehavior(params).then(function (e) {\n        _this.isLoading = false;\n\n        if (e.success) {\n          var shareDailyResultTypes = e.shareDailyResultTypes;\n          var payBehav = e.payBehavMap;\n          var payBehavs = [];\n          var numberMap = new Map();\n\n          var _loop = function _loop(key) {\n            //每天总付费次数\n            var i = 0;\n\n            for (var keys in payBehav[key]) {\n              i += payBehav[key][keys].length;\n            }\n\n            numberMap.set(key, i);\n            var payBehavObject = new Object();\n            payBehavObject.ds = weekChange(key);\n            var sunMoneyOne = 0,\n                sunMoneyTwo = 0,\n                sunMoneyThree = 0,\n                sunMoneyFoure = 0,\n                sunMoneyFive = 0,\n                sunMoneySix = 0,\n                sunMoneySeven = 0;\n            var peopleSetOne = new Set(),\n                peopleSetTwo = new Set(),\n                peopleSetThree = new Set(),\n                peopleSetFoure = new Set(),\n                peopleSetFive = new Set(),\n                peopleSetSix = new Set(),\n                peopleSetSeven = new Set();\n            payBehav[key].collectOne.forEach(function (item) {\n              sunMoneyOne += item.amount;\n              peopleSetOne.add(item.userid);\n            });\n            var sumPeopleOne = peopleSetOne.size;\n            payBehavObject.one = sunMoneyOne / _this.getStore(\"currencyRate\");\n            payBehavObject.onePeople = sumPeopleOne;\n            payBehav[key].collectTwo.forEach(function (item) {\n              sunMoneyTwo += item.amount;\n              peopleSetTwo.add(item.userid);\n            });\n            var sumPeopleTwo = peopleSetTwo.size;\n            payBehavObject.two = sunMoneyTwo / _this.getStore(\"currencyRate\");\n            payBehavObject.twoPeople = sumPeopleTwo;\n            payBehav[key].collectThree.forEach(function (item) {\n              sunMoneyThree += item.amount;\n              peopleSetThree.add(item.userid);\n            });\n            var sumPeopleThree = peopleSetThree.size;\n            payBehavObject.three = sunMoneyThree / _this.getStore(\"currencyRate\");\n            payBehavObject.threePeople = sumPeopleThree;\n            payBehav[key].collectFoure.forEach(function (item) {\n              sunMoneyFoure += item.amount;\n              peopleSetFoure.add(item.userid);\n            });\n            var sumPeopleFoure = peopleSetFoure.size;\n            payBehavObject.foure = sunMoneyFoure / _this.getStore(\"currencyRate\");\n            payBehavObject.fourePeople = sumPeopleFoure;\n            payBehav[key].collectFive.forEach(function (item) {\n              sunMoneyFive += item.amount;\n              peopleSetFive.add(item.userid);\n            });\n            var sumPeopleFive = peopleSetFive.size;\n            payBehavObject.five = sunMoneyFive / _this.getStore(\"currencyRate\");\n            payBehavObject.fivePeople = sumPeopleFive;\n            payBehav[key].collectSix.forEach(function (item) {\n              sunMoneySix += item.amount;\n              peopleSetSix.add(item.userid);\n            });\n            var sumPeopleSix = peopleSetSix.size;\n            payBehavObject.six = sunMoneySix / _this.getStore(\"currencyRate\");\n            payBehavObject.sixPeople = sumPeopleSix;\n            payBehav[key].collectSeven.forEach(function (item) {\n              sunMoneySeven += item.amount;\n              peopleSetSeven.add(item.userid);\n            });\n            var sumPeopleSeven = peopleSetSeven.size;\n            payBehavObject.seven = sunMoneySeven / _this.getStore(\"currencyRate\");\n            payBehavObject.sevenPeople = sumPeopleSeven;\n            payBehavs.push(payBehavObject);\n          };\n\n          for (var key in payBehav) {\n            _loop(key);\n          } //折线图\n\n\n          var charts = [];\n          shareDailyResultTypes.sort(_this.compareR);\n          shareDailyResultTypes.forEach(function (item) {\n            var i = item.dauNum == 0 ? 0 : ((numberMap.get(item.ds) || 0) / item.dauNum).toFixed(3);\n            var chartObject = new Object();\n            chartObject.ds = item.ds.substr(5, 5);\n            chartObject.value = i;\n            charts.push(chartObject);\n          });\n          payBehavs.sort(_this.compare); //付费行为汇总--分组柱状图\n\n          var payBehavTotalOne = 0,\n              payBehavTotalOneP = 0,\n              payBehavTotalTwo = 0,\n              payBehavTotalTwoP = 0,\n              payBehavTotalThree = 0,\n              payBehavTotalThreeP = 0,\n              payBehavTotalFoure = 0,\n              payBehavTotalFoureP = 0,\n              payBehavTotalFive = 0,\n              payBehavTotalFiveP = 0,\n              payBehavTotalSix = 0,\n              payBehavTotalSixP = 0,\n              payBehavTotalSeven = 0,\n              payBehavTotalSevenP = 0;\n          payBehavs.forEach(function (item) {\n            payBehavTotalOne += item.one;\n            payBehavTotalOneP += item.onePeople;\n            payBehavTotalTwo += item.two;\n            payBehavTotalTwoP += item.twoPeople;\n            payBehavTotalThree += item.three;\n            payBehavTotalThreeP += item.threePeople;\n            payBehavTotalFoure += item.foure;\n            payBehavTotalFoureP += item.fourePeople;\n            payBehavTotalFive += item.five;\n            payBehavTotalFiveP += item.fivePeople;\n            payBehavTotalSix += item.six;\n            payBehavTotalSixP += item.sixPeople;\n            payBehavTotalSeven += item.seven;\n            payBehavTotalSevenP += item.sevenPeople;\n          });\n          var payBehavesChart = [];\n          var payBehavTotalOneObjectChart = new Object();\n          payBehavTotalOneObjectChart.name = '付费额';\n          payBehavTotalOneObjectChart.payNum = '[0,10]';\n          payBehavTotalOneObjectChart.value = payBehavTotalOne;\n          payBehavesChart.push(payBehavTotalOneObjectChart);\n          var payBehavTotalOnePObjectChart = new Object();\n          payBehavTotalOnePObjectChart.name = '付费人数';\n          payBehavTotalOnePObjectChart.payNum = '[0,10]';\n          payBehavTotalOnePObjectChart.value = payBehavTotalOneP;\n          payBehavesChart.push(payBehavTotalOnePObjectChart);\n          var payBehavTotalTwoObjectChart = new Object();\n          payBehavTotalTwoObjectChart.name = '付费额';\n          payBehavTotalTwoObjectChart.payNum = '(10,50]';\n          payBehavTotalTwoObjectChart.value = payBehavTotalTwo;\n          payBehavesChart.push(payBehavTotalTwoObjectChart);\n          var payBehavTotalTwoPObjectChart = new Object();\n          payBehavTotalTwoPObjectChart.name = '付费人数';\n          payBehavTotalTwoPObjectChart.payNum = '(10,50]';\n          payBehavTotalTwoPObjectChart.value = payBehavTotalTwoP;\n          payBehavesChart.push(payBehavTotalTwoPObjectChart);\n          var payBehavTotalThreeObjectChart = new Object();\n          payBehavTotalThreeObjectChart.name = '付费额';\n          payBehavTotalThreeObjectChart.payNum = '(50,100]';\n          payBehavTotalThreeObjectChart.value = payBehavTotalThree;\n          payBehavesChart.push(payBehavTotalThreeObjectChart);\n          var payBehavTotalThreePObjectChart = new Object();\n          payBehavTotalThreePObjectChart.name = '付费人数';\n          payBehavTotalThreePObjectChart.payNum = '(50,100]';\n          payBehavTotalThreePObjectChart.value = payBehavTotalThreeP;\n          payBehavesChart.push(payBehavTotalThreePObjectChart);\n          var payBehavTotalFoureObjectChart = new Object();\n          payBehavTotalFoureObjectChart.name = '付费额';\n          payBehavTotalFoureObjectChart.payNum = '(100,200]';\n          payBehavTotalFoureObjectChart.value = payBehavTotalFoure;\n          payBehavesChart.push(payBehavTotalFoureObjectChart);\n          var payBehavTotalFourePObjectChart = new Object();\n          payBehavTotalFourePObjectChart.name = '付费人数';\n          payBehavTotalFourePObjectChart.payNum = '(100,200]';\n          payBehavTotalFourePObjectChart.value = payBehavTotalFoureP;\n          payBehavesChart.push(payBehavTotalFourePObjectChart);\n          var payBehavTotalFiveObjectChart = new Object();\n          payBehavTotalFiveObjectChart.name = '付费额';\n          payBehavTotalFiveObjectChart.payNum = '(200,500]';\n          payBehavTotalFiveObjectChart.value = payBehavTotalFive;\n          payBehavesChart.push(payBehavTotalFiveObjectChart);\n          var payBehavTotalFivePObjectChart = new Object();\n          payBehavTotalFivePObjectChart.name = '付费人数';\n          payBehavTotalFivePObjectChart.payNum = '(200,500]';\n          payBehavTotalFivePObjectChart.value = payBehavTotalFiveP;\n          payBehavesChart.push(payBehavTotalFivePObjectChart);\n          var payBehavTotalSixObjectChart = new Object();\n          payBehavTotalSixObjectChart.name = '付费额';\n          payBehavTotalSixObjectChart.payNum = '(500,1000]';\n          payBehavTotalSixObjectChart.value = payBehavTotalSix;\n          payBehavesChart.push(payBehavTotalSixObjectChart);\n          var payBehavTotalSixPObjectChart = new Object();\n          payBehavTotalSixPObjectChart.name = '付费人数';\n          payBehavTotalSixPObjectChart.payNum = '(500,1000]';\n          payBehavTotalSixPObjectChart.value = payBehavTotalSixP;\n          payBehavesChart.push(payBehavTotalSixPObjectChart);\n          var payBehavTotalSevenObjectChart = new Object();\n          payBehavTotalSevenObjectChart.name = '付费额';\n          payBehavTotalSevenObjectChart.payNum = '1000以上';\n          payBehavTotalSevenObjectChart.value = payBehavTotalSeven;\n          payBehavesChart.push(payBehavTotalSevenObjectChart);\n          var payBehavTotalSevenPObjectChart = new Object();\n          payBehavTotalSevenPObjectChart.name = '付费人数';\n          payBehavTotalSevenPObjectChart.payNum = '1000以上';\n          payBehavTotalSevenPObjectChart.value = payBehavTotalSevenP;\n          payBehavesChart.push(payBehavTotalSevenPObjectChart);\n          _this.payBehavs = payBehavs;\n          _this.payBehavesChart = payBehavesChart;\n          _this.charts = charts;\n\n          _this.surveyOneLine.changeData(_this.charts);\n\n          _this.pyaGroupChart.changeData(_this.payBehavesChart);\n        }\n      });\n    },\n    reportLineChart: function reportLineChart() {\n      // 分组柱状图\n      this.pyaGroupChart = new G2.Chart({\n        container: 'payChartGroup',\n        forceFit: true,\n        height: 300\n      });\n      this.pyaGroupChart.source(this.payBehavesChart);\n      this.pyaGroupChart.interval().position('payNum*value').color('name').adjust([{\n        type: 'dodge',\n        marginRatio: 1 / 32\n      }]);\n      this.pyaGroupChart.render(); // 折线图\n\n      this.surveyOneLine = new G2.Chart({\n        container: 'payChart',\n        forceFit: true,\n        height: 300\n      });\n      this.surveyOneLine.source(this.handelRetentionOne, {});\n      this.surveyOneLine.scale('value', {\n        min: 0,\n        alias: '人均付费次数'\n      });\n      this.surveyOneLine.scale('ds', {\n        // range: [0, 1]\n        tickCount: 6\n      });\n      this.surveyOneLine.tooltip({\n        crosshairs: {\n          type: 'line'\n        }\n      }); // 坐标轴文本旋转\n\n      this.surveyOneLine.axis('ds', {\n        label: {\n          rotate: -Math.PI / 2.5,\n          textAlign: 'end',\n          textBaseline: 'middle'\n        }\n      });\n      this.surveyOneLine.line().position('ds*value').shape('smooth');\n      this.surveyOneLine.point().position('ds*value').size(4).shape('circle').style({\n        stroke: '#fff',\n        lineWidth: 1\n      }).color('l(0) 0:#1E90FF 0.5:#1E90FF 1:#1E90FF');\n      this.surveyOneLine.area().position('ds*value').shape('smooth');\n      this.surveyOneLine.render();\n    },\n    compare: function compare(obj1, obj2) {\n      var val1 = obj1.ds;\n      var val2 = obj2.ds;\n\n      if (val1 < val2) {\n        return 1;\n      } else if (val1 > val2) {\n        return -1;\n      } else {\n        return 0;\n      }\n    },\n    compareR: function compareR(obj1, obj2) {\n      var val1 = obj1.ds;\n      var val2 = obj2.ds;\n\n      if (val1 < val2) {\n        return -1;\n      } else if (val1 > val2) {\n        return 1;\n      } else {\n        return 0;\n      }\n    }\n  },\n  mounted: function mounted() {\n    this.reportLineChart();\n    this.init();\n  }\n};",null]}