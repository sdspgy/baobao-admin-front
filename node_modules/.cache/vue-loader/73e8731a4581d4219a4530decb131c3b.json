{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportData/reportOnline/reportOnline.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportData/reportOnline/reportOnline.vue","mtime":1579338322575},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {queryOnline} from '@/api/index';\nimport {weekChange} from '@/libs/changeWeek';\n\nexport default {\n    name: \"reportOnline\",\n    data() {\n        return {\n            defaultData: {\n                yestoday: 1,\n                week: 7,\n                month: 30\n            },\n            data: \"7\",\n            columns: [\n                {\n                    title: '日期（星期）',\n                    key: 'ds',\n                    width: 150,\n                    fixed: 'left'\n                },\n                {\n                    title: '持续时长',\n                    key: 'duration',\n                    width: 150,\n                    fixed: 'left'\n                },\n                {\n                    title: '人数',\n                    key: 'durationNumbers',\n                    width: 150,\n                    fixed: 'left'\n                },\n                {\n                    title: '留存用户数',\n                    key: 'durationRetentionNumbers',\n                    width: 150,\n                    fixed: 'left'\n                },\n            ],\n            tableV: [],\n            charts: [],\n            pyaGroupChart: {},\n        }\n    },\n    methods: {\n        init() {\n            this.queryOnline();\n\n        },\n        queryOnline() {\n            let params = {\n                gameid: parseInt(this.getStore('gameid')),\n                date: parseInt(this.data)\n            }\n            queryOnline(params).then(e => {\n                if (e.success) {\n                    let onlines = e.onlineDurationDistributions;\n                    onlines.sort(this.compare);\n                    let firstData = [];\n                    onlines.forEach(item => {\n                        item.ds = weekChange(item.ds);\n                        //取出最近一天的\n                        if (item.ds == onlines[0].ds) {\n                            firstData.push(item);\n                        }\n                    })\n                    //处理分组柱状图数据\n                    let charts = [];\n                    firstData.forEach(item => {\n                        let peoplesObj = new Object();\n                        peoplesObj.name = '人数';\n                        peoplesObj.duration = item.duration;\n                        peoplesObj.value = item.durationNumbers;\n                        let dauNumObj = new Object();\n                        dauNumObj.name = '留存用户数';\n                        dauNumObj.duration = item.duration;\n                        dauNumObj.value = item.durationRetentionNumbers;\n                        charts.push(peoplesObj);\n                        charts.push(dauNumObj);\n                    })\n                    this.charts = charts;\n                    this.tableV = onlines;\n                    this.pyaGroupChart.changeData(this.charts);\n                }\n            })\n        },\n        clickOnlineTable(data) {\n            let firstData = [];\n            this.tableV.forEach(item => {\n                if (item.ds == data.ds) {\n                    firstData.push(item);\n                }\n            })\n            let charts = [];\n            firstData.forEach(item => {\n                let peoplesObj = new Object();\n                peoplesObj.name = '人数';\n                peoplesObj.duration = item.duration;\n                peoplesObj.value = item.durationNumbers;\n                let dauNumObj = new Object();\n                dauNumObj.name = '留存用户数';\n                dauNumObj.duration = item.duration;\n                dauNumObj.value = item.durationRetentionNumbers;\n                charts.push(peoplesObj);\n                charts.push(dauNumObj);\n            })\n            this.charts = charts;\n            this.pyaGroupChart.changeData(this.charts);\n        },\n        G2Online() {\n            // 分组柱状图\n            this.pyaGroupChart = new G2.Chart({\n                container: 'onlineG2',\n                forceFit: true,\n                height: 500\n            });\n            this.pyaGroupChart.source(this.charts);\n            this.pyaGroupChart.interval().position('duration*value').color('name')\n                .adjust([{\n                    type: 'dodge',\n                    marginRatio: 1 / 32\n                }]);\n            this.pyaGroupChart.render();\n        },\n        compare: function (obj1, obj2) {\n            var val1 = obj1.ds;\n            var val2 = obj2.ds;\n            if (val1 < val2) {\n                return 1;\n            } else if (val1 > val2) {\n                return -1;\n            } else {\n                return 0;\n            }\n        },\n    },\n    mounted() {\n        this.G2Online();\n        this.init();\n    }\n    ,\n}\n",null]}