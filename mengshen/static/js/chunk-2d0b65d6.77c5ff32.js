(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b65d6"],{"1d9f":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("Row",[i("Table",{ref:"table",attrs:{border:"",columns:e.columns,data:e.data,sortable:"custom"}})],1),i("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[i("Page",{attrs:{current:e.searchForm.pageNumber,total:e.total,"page-size":e.searchForm.pageSize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1),i("Modal",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500,styles:{top:"30px"}},model:{value:e.ModalVisible,callback:function(t){e.ModalVisible=t},expression:"ModalVisible"}},[i("Form",{ref:"userForm",attrs:{model:e.userForm,"label-width":70}},[i("FormItem",{attrs:{label:"角色分配",prop:"roles"}},[i("Select",{staticStyle:{width:"200px"},model:{value:e.userForm.roles,callback:function(t){e.$set(e.userForm,"roles",t)},expression:"userForm.roles"}},e._l(e.roleList,(function(t){return i("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:function(t){e.ModalVisible=!1}}},[e._v("取消")]),i("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submitMiniUser}},[e._v("提交")])],1)],1),i("Modal",{attrs:{title:e.modalGrantTitle,"mask-closable":!1,width:500,styles:{top:"30px"}},model:{value:e.ModalVisibleGrant,callback:function(t){e.ModalVisibleGrant=t},expression:"ModalVisibleGrant"}},[i("Form",{ref:"gameForm",attrs:{model:e.gameForm,"label-width":70}},[i("FormItem",{attrs:{label:"游戏分配",prop:"games"}},[i("Select",{attrs:{multiple:""},model:{value:e.gameForm.games,callback:function(t){e.$set(e.gameForm,"games",t)},expression:"gameForm.games"}},e._l(e.games,(function(t){return i("Option",{key:t.id,attrs:{value:t.id,label:t.name}},[i("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(t.name))])])})),1)],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:function(t){e.ModalVisibleGrant=!1}}},[e._v("取消")]),i("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submitMiniGrant}},[e._v("提交")])],1)],1)],1)},a=[],r=i("365c"),o={name:"miniUser",data:function(){var e=this;return{columns:[{type:"selection",width:60,align:"center",fixed:"left"},{type:"index",width:60,align:"center",fixed:"left"},{title:"openID",key:"openId",width:150},{title:"微信名",key:"name",width:150},{title:"头像",key:"avatarUrl",width:80,align:"center",render:function(e,t){return e("Avatar",{props:{src:t.row.avatarUrl}})}},{title:"操作",key:"action",width:200,align:"center",render:function(t,i){var s=t("Button",{props:{type:"primary",size:"small",disabled:!e.$route.meta.permTypes.includes("edit")},style:{marginRight:"5px"},on:{click:function(){e.edit(i.row)}}},"角色分配"),a=t("Button",{props:{type:"primary",size:"small",disabled:!e.$route.meta.permTypes.includes("add")},style:{marginRight:"5px"},on:{click:function(){e.add(i.row)}}},"授权游戏");return t("div",[s,a])}}],data:[],searchForm:{name:"",pageNumber:1,pageSize:10},miniUserForm:[],userForm:{roles:[]},gameForm:{games:[]},roleList:[],modalType:1,modalTitle:"分配角色",modalGrantTitle:"分配游戏",ModalVisible:!1,ModalVisibleGrant:!1,total:0,submitLoading:!1,games:[]}},mounted:function(){this.init(),this.getRoleList(),this.getGames()},methods:{init:function(){this.queryAll()},handleSearch:function(){this.queryAll()},queryAll:function(){var e=this;Object(r["Ob"])(this.searchForm).then((function(t){t.success&&(e.data=t.msg.records,e.total=t.count)}))},changePage:function(e){this.searchForm.pageNumber=e,this.queryAll(),this.clearSelectAll()},changePageSize:function(e){this.searchForm.pageSize=e,this.queryAll()},clearSelectAll:function(){this.$refs.table.selectAll(!1)},edit:function(e){this.modalType=1,this.modalTitle="角色分配",this.$refs.userForm.resetFields();e.openId;for(var t in e)null==e[t]&&(e[t]="");var i=JSON.stringify(e),s=JSON.parse(i);this.miniUserForm=s,this.ModalVisible=!0},add:function(e){this.modalGrantTitle="分配游戏",this.$refs.userForm.resetFields();e.openId;for(var t in e)null==e[t]&&(e[t]="");var i=JSON.stringify(e),s=JSON.parse(i);this.miniUserForm=s,this.ModalVisibleGrant=!0},submitMiniUser:function(){var e=this;this.$refs.userForm.validate((function(t){t&&(e.submitLoading=!0,Object(r["N"])({openId:e.miniUserForm.openId,roleId:e.userForm.roles}).then((function(t){e.submitLoading=!1,t.success&&(e.$Message.success("操作成功"),e.ModalVisible=!1)})))}))},submitMiniGrant:function(){var e=this;this.$refs.gameForm.validate((function(t){t&&(e.submitLoading=!0,Object(r["O"])({openId:e.miniUserForm.openId,gameIds:e.gameForm.games}).then((function(t){e.submitLoading=!1,t.success&&(e.$Message.success("操作成功"),e.ModalVisibleGrant=!1)})))}))},getRoleList:function(){var e=this;Object(r["ab"])().then((function(t){t.success&&(e.roleList=JSON.parse(t.msg))}))},getGames:function(){var e=this;Object(r["Z"])().then((function(t){t.success&&(e.games=JSON.parse(t.msg))}))}}},n=o,l=i("2877"),c=Object(l["a"])(n,s,a,!1,null,"48487eb0",null);t["default"]=c.exports}}]);