{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportdata/reportAdd/reportAdd.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/reportdata/reportAdd/reportAdd.vue","mtime":1587108759730},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { queryAllPayReq } from '@/api/index';\nimport vTitleHead from '../../game/template/TitleHead';\nexport default {\n  name: 'pay',\n  components: {\n    vTitleHead: vTitleHead\n  },\n  comments: {},\n  data: function data() {\n    return {\n      loadingAdd: true,\n      isShow: true,\n      installTable: '新增数据',\n      installTables: '新增数据(Android/iOS)',\n      installChart: '新增趋势',\n      columnspro: [],\n      columns: [{\n        title: '日期(星期)',\n        key: 'ds',\n        align: 'center',\n        width: 150 // sortable: true\n\n      }, {\n        title: '操作系统',\n        key: 'os',\n        width: 100,\n        align: 'center',\n        checkAccess: [2] // sortable: true,\n        // fixed: 'left'\n\n      }, {\n        title: '小时',\n        key: 'dayOfHour',\n        width: 100,\n        checkAccess: [3] //   render:(h,params)=>{\n        //       return h('div', { style: {\n        //               display:(params.row.dayOfHour==0)?\"none\":\"inline-block\",\n        //               color: '#FF7D41'\n        //       }\n        //       },params.row.dayOfHour);\n        // },\n        // sortable: true\n\n      }, {\n        title: '渠道',\n        key: 'creative',\n        width: 100,\n        align: 'center',\n        checkAccess: [4] // sortable: true\n\n      }, {\n        title: '服',\n        key: 'clientid',\n        width: 100,\n        align: 'center',\n        checkAccess: [1] // sortable: true\n\n      }, {\n        title: '注册数',\n        key: 'installNum',\n        align: 'center',\n        width: 80\n      }, {\n        title: '新付费率（%）',\n        key: 'payInstallRate',\n        align: 'center',\n        width: 130\n      }, {\n        title: '新付费ARPU',\n        key: 'payInstallARPU',\n        align: 'center',\n        width: 120\n      }, {\n        title: '新付费ARPPU',\n        key: 'payInstallARPPU',\n        align: 'center',\n        width: 120\n      }, {\n        title: '新付费人数',\n        key: 'payInstallCount',\n        align: 'center',\n        width: 100\n      }, {\n        title: '新付费总额',\n        key: 'payInstallAmount',\n        align: 'center',\n        width: 100\n      }, {\n        title: '新付费次数',\n        key: 'payInstallTimes' // align: 'center',\n        // width: 100\n\n      } // {\n      // \ttitle: '创建时间',\n      // \tkey: 'createTime',\n      // \tsortable: true,\n      // \tsortType: 'desc',\n      // \twidth: 150\n      // },\n      ],\n      columnscc: [{\n        title: '日期(星期)',\n        key: 'ds',\n        align: 'center',\n        width: 120\n      }, {\n        title: '操作系统',\n        key: 'os',\n        align: 'center',\n        width: 100\n      }, {\n        title: '注册数',\n        key: 'installNum',\n        align: 'center',\n        width: 80\n      }, {\n        title: '新付费率（%）',\n        key: 'payInstallRate',\n        align: 'center',\n        width: 130\n      }, {\n        title: '新付费ARPU',\n        key: 'payInstallARPU',\n        align: 'center',\n        width: 120\n      }, {\n        title: '新付费ARPPU',\n        key: 'payInstallARPPU',\n        align: 'center',\n        width: 120\n      }, {\n        title: '新付费人数',\n        key: 'payInstallCount',\n        align: 'center',\n        width: 100\n      }, {\n        title: '新付费总额',\n        key: 'payInstallAmount',\n        align: 'center',\n        width: 100\n      }, {\n        title: '新付费次数',\n        key: 'payInstallTimes' // width: 150\n        // sortable: true\n\n      }],\n      data: [],\n      searchForm: {\n        source: '0',\n        creativeid: '',\n        clientid: '',\n        gameid: parseInt(this.getStore('gameid')),\n        day: '7',\n        os: '0',\n        page: 1\n      },\n      total: 0,\n      games: [],\n      sharePayResultTypesCC: [],\n      creatives: [],\n      clients: [],\n      clientmap: [],\n      creativemap: [],\n      surveyOneLine: {},\n      datas: [],\n      key: 'all',\n      showcreative: false,\n      showclient: false,\n      showcc: true\n    };\n  },\n  methods: {\n    init: function init() {\n      this.loadingAdd = true;\n\n      if (this.getStore('parentId') == 0) {\n        this.isShow = true;\n      } else {\n        this.isShow = false;\n      }\n\n      this.queryAllServer();\n    },\n    handleSearch: function handleSearch() {\n      this.queryAllServer();\n    },\n    queryAllServer: function queryAllServer() {\n      var _this = this;\n\n      this.columnspro = JSON.parse(JSON.stringify(this.columns));\n\n      if (this.searchForm.day != 0 && this.searchForm.day != 1) {\n        this.handleColumns(3);\n      }\n\n      if (this.searchForm.os == 0 && this.searchForm.clientid == '' && this.searchForm.creative == null) {\n        this.handleColumns(2);\n      }\n\n      if (this.searchForm.clientid == '') {\n        this.handleColumns(1);\n      }\n\n      if (this.searchForm.creative == null) {\n        this.handleColumns(4);\n      }\n\n      queryAllPayReq(this.searchForm).then(function (res) {\n        _this.loadingAdd = false;\n\n        if (res.success) {\n          _this.sharePayResultTypesCC = res.sharePayResultTypesCC;\n          _this.creatives = res.creatives;\n          _this.clients = res.clients; //\n\n          _this.creativemap = res.creatives.map(function (item) {\n            return {\n              key: item.creativeid,\n              name: item.creativeName\n            };\n          });\n          var allObject = new Object();\n          allObject.key = '0';\n          allObject.name = '全渠道';\n\n          _this.creativemap.unshift(allObject);\n\n          var creativeMap = new Map();\n\n          _this.creativemap.forEach(function (item, index) {\n            creativeMap.set(item.key, item.name);\n          }); //\n\n\n          _this.clientmap = res.clients.map(function (item) {\n            return {\n              key: item.serverid,\n              name: item.serverName\n            };\n          });\n          var allObject2 = new Object();\n          allObject2.key = '-1';\n          allObject2.name = '所有服';\n\n          _this.clientmap.unshift(allObject2);\n\n          var clientMap = new Map();\n\n          _this.clientmap.forEach(function (item, indx) {\n            clientMap.set(item.key, item.name);\n          });\n\n          _this.data = _this.tableDataProcess(res.msg, creativeMap, clientMap);\n          _this.sharePayResultTypesCC = _this.tableDataProcess(res.sharePayResultTypesCC, creativeMap, clientMap);\n          var datac = [];\n\n          _this.data.forEach(function (item) {\n            datac.push(item.installNum);\n          });\n\n          _this.datas = _this.f2DI(datac, _this.searchForm.day, _this.data, 0);\n\n          _this.surveyOneLine.changeData(_this.datas);\n        }\n      });\n    },\n    showclients: function showclients(val) {\n      if (this.key == 'all') {\n        this.showcreative = false;\n        this.showclient = false;\n        this.showcc = true;\n        delete this.searchForm.creative;\n        this.searchForm.clientid = '';\n        this.init();\n      } else if (this.key == 'creative') {\n        this.showcreative = true;\n        this.showclient = false;\n        this.showcc = false;\n        this.searchForm.creative = '0';\n        this.searchForm.clientid = '';\n        this.init();\n      } else {\n        this.showcreative = false;\n        this.showclient = true;\n        this.showcc = false;\n        delete this.searchForm.creative;\n        this.searchForm.clientid = '-1';\n        this.init();\n      }\n    },\n    handleColumns: function handleColumns(access) {\n      var _this2 = this;\n\n      this.columnspro.map(function (item, index) {\n        var checkAccess = item.checkAccess;\n\n        if (checkAccess) {\n          if (checkAccess - Number(access) == 0) {\n            _this2.columnspro.splice(index, 1);\n          } else {\n            console.log(index);\n          }\n        }\n      });\n    },\n    weekFunction: function weekFunction(ds) {\n      var week = new Date(ds);\n      var dateweek = week.getDay();\n      var i = 7 - dateweek;\n\n      switch (i) {\n        case 7:\n          ds = ds + \"(七)\";\n          break;\n\n        case 1:\n          ds = ds + \"(六)\";\n          break;\n\n        case 2:\n          ds = ds + \"(五)\";\n          break;\n\n        case 3:\n          ds = ds + \"(四)\";\n          break;\n\n        case 4:\n          ds = ds + \"(三)\";\n          break;\n\n        case 5:\n          ds = ds + \"(二)\";\n          break;\n\n        case 6:\n          ds = ds + \"(一)\";\n          break;\n\n        default:\n      }\n\n      return ds;\n    },\n    surveyOneLineChart: function surveyOneLineChart() {\n      /*---------------------单折线图-------------------*/\n      this.surveyOneLine = new G2.Chart({\n        container: 'surveyOneLine',\n        forceFit: true,\n        height: 300\n      });\n      this.surveyOneLine.source(this.datas, {});\n      this.surveyOneLine.scale('value', {\n        min: 0,\n        alias: '人数'\n      });\n      this.surveyOneLine.scale('time', {\n        // range: [0, 1]\n        tickCount: 9\n      });\n      this.surveyOneLine.tooltip({\n        crosshairs: {\n          type: 'line'\n        }\n      }); // 坐标轴文本旋转\n\n      this.surveyOneLine.axis('time', {\n        label: {\n          rotate: -Math.PI / 4,\n          textAlign: 'end',\n          textBaseline: 'middle'\n        }\n      });\n      this.surveyOneLine.line().position('time*value').shape('smooth');\n      this.surveyOneLine.point().position('time*value').size(4).shape('circle').style({\n        stroke: '#fff',\n        lineWidth: 1\n      }).color('l(0) 0:#1E90FF 0.5:#1E90FF 1:#1E90FF');\n      this.surveyOneLine.area().position('time*value').shape('smooth');\n      this.surveyOneLine.render(); // return this.surveyOneLine;\n    },\n    f2DI: function f2DI(data, date, listData, type) {\n      var datas = [];\n\n      if (date == 0 || date == 1) {\n        listData.forEach(function (info) {\n          var item = new Object();\n\n          if (type == 0) {\n            item.value = info.dauNum;\n          } else {\n            item.value = info.installNum;\n          }\n\n          item.time = info.dayOfHour + '时';\n          datas.push(item);\n        });\n      } else {\n        listData.forEach(function (item, index) {\n          var info = new Object();\n          info.time = item.ds.substr(5, 5);\n          info.value = item.installNum;\n          datas.push(info);\n        });\n      }\n\n      if (date == \"7\" || date == \"30\" || date == \"0\") {\n        //该方法会改变原来的数组，而不会创建新的数组\n        datas.reverse();\n      }\n\n      return datas;\n    },\n    getTime: function getTime(index) {\n      var myDate = new Date();\n      myDate.setTime(myDate.getTime() - 24 * 60 * 60 * 1000 * (index + 1));\n      var dateTime = myDate.getMonth() + 1 + \"-\" + myDate.getDate();\n      return dateTime;\n    },\n    tableDataProcess: function tableDataProcess(data, creativeMap, clientMap) {\n      var _this3 = this;\n\n      if (data) {\n        data.forEach(function (item) {\n          item.ds = _this3.weekFunction(item.ds);\n          item.client = clientMap.get(String(item.clientid)) === undefined ? item.client : clientMap.get(String(item.clientid));\n          item.creative = creativeMap.get(item.creative) === undefined ? item.creative : creativeMap.get(item.creative);\n          item.payInstallRate = item.installNum == 0 ? 0 : (item.payInstallCount * 100 / item.installNum).toFixed(2);\n          item.payInstallARPU = item.installNum == 0 ? 0 : (item.payInstallAmount / item.installNum).toFixed(2);\n          item.payInstallARPPU = item.payInstallCount == 0 ? 0 : (item.payInstallAmount / item.payInstallCount).toFixed(2);\n          item.payInstallAmount = item.payInstallAmount / _this3.getStore(\"currencyRate\");\n        });\n      }\n\n      return data;\n    }\n  },\n  mounted: function mounted() {\n    this.init();\n    this.surveyOneLineChart();\n  }\n};",null]}